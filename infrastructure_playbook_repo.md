# [Infrastructure Playbook repository](https://github.com/usegalaxy-eu/infrastructure-playbook)

## Generic introduction
* This repository contains the [Ansible](https://www.ansible.com/) playbooks, roles, etc for the European Galaxy server. It is used to deploy the infrastructure for the European Galaxy server through [Jenkins](https://build.galaxyproject.eu/job/usegalaxy-eu/). All configurational changes related to the [Galaxy EU](https://usegalaxy.eu) are made through this repository.
* Galaxy EU compute infrastructure is run on the [BW OpenStack cloud](https://portal.bw-cloud.org/). At the time of writing (21/02/2023) our cloud is of size 8488 VCPUs, 44.6 TB RAM, 162.6 TB storage. Additionally, a few petabytes of [storage](https://github.com/usegalaxy-eu/operations/blob/main/storage.md) is also mounted (NFS) in the cloud.
* The compute infrastructure (cloud cluster; Galaxy worker nodes) is configured through [VGCN infrastructure repo](https://github.com/usegalaxy-eu/vgcn-infrastructure) where we define what [cloud images](https://github.com/usegalaxy-eu/vgcn) should be used, the size of the cloud cluster, the number of VMs, the cloud network, the cloud security groups, etc.
* The cloud (VMs for group members and non Galaxy worker nodes) is configured through this [infrastructure repo](https://github.com/usegalaxy-eu/infrastructure) using [Terraform](https://www.terraform.io/). The underlying cloud hardware, storage, network, etc are managed by the compute center of the University of Freiburg. For DNS records we use [Amazon's Route53](https://aws.amazon.com/route53/).
* Some documentation related to [services](https://github.com/usegalaxy-eu/operations/blob/main/cloud/services.md) and IT operations are available in this [operations repo](https://github.com/usegalaxy-eu/operations)
* For Galaxy Admin training you can refer [here](https://training.galaxyproject.org/training-material/topics/admin/)
* For monitoring of the Galaxy EU infrastructure we use [Grafana](https://grafana.com/). The dashboards are available [here](https://stats.galaxyproject.eu/)

## Ansible
* [Ansible](https://www.ansible.com/) is an open-source software provisioning, configuration management, and application-deployment tool enabling infrastructure as code.
* The basic components of Ansible can be found [here](https://docs.ansible.com/ansible/latest/network/getting_started/basic_concepts.html). Understanding this is important to understand this repo.

## Our repo structure
* [files](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/files): contains files/configs that are used by the playbooks/roles
* [group_vars](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/group_vars) and [host_vars](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/host_vars): contains variables that are used by the playbooks specific to certain host/group defined in the [inventory file](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/hosts). For every playbook we have an associated group_vars/host_vars file where we define the variables that are used by the playbook and the roles that are included/imported in the playbook.
* [roles](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles): Contains roles that are **not** maintained somewhere else, which is not typical for Ansible. All other roles are installed during deployment from the requirements.yaml file.
* [secret_group_vars](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/secret_group_vars): This is our vault. It contains the passwords and other sensitive information that is used by the playbooks/roles. The files are encrypted using [Ansible Vault](https://docs.ansible.com/ansible/latest/user_guide/vault.html).
* [templates](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/templates): contains the templates that are used by the playbooks/roles. The templates are used to generate the final configuration files that are used by the services. The templates are written in [Jinja2](https://jinja.palletsprojects.com/en/3.0.x/) syntax.
* [ansible.cfg](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/ansible.cfg): contains the configuration of Ansible. This is used to define the location of the inventory file, the vault password file, etc.
* [hosts](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/hosts): contains the inventory of the hosts that are managed by Ansible.

## Playbooks
The playbooks are located in the [root directory](https://github.com/usegalaxy-eu/infrastructure-playbook) of the repo.

The playbooks are:

  * [apollo.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/apollo.yml): [Apollo](https://genomearchitect.readthedocs.io/en/latest/) is a genome annotation web-based editor. This can be accessed through Galaxy to view, edit, and annotate genomes. Uses Tomcat, therefore run on a separate server. Additional information can be found [here](https://github.com/usegalaxy-eu/operations/blob/f8062472110116a4ddf3035c3d43374443ec235e/cloud/services.md#apollo)
  * [beacon.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/beacon.yml): [Beacon](https://beacon-project.io/) is a service that allows to query for the presence of specific variants in a given dataset. We provide this service as part of our Galaxy EU instance. This is run on a [VM](https://github.com/usegalaxy-eu/infrastructure/blob/main/instance_dedicated_beacon.tf) on the cloud.
  * [build.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/build.yml): This playbook is used to setup our [Jenkins server](https://build.galaxyproject.eu/). This is also our HTCondor central manager server. (This server and playbooks will be deprecated, on the account of new `sn12` server and a playbook will be added later).
  * [celery.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/celery.yml): This playbook is used to setup the [Celery](https://docs.celeryq.dev/en/stable/) node(s) that are used by Galaxy for running various jobs. For more information refer to this [doc](https://github.com/usegalaxy-eu/operations/blob/main/celery.md) and our [training material](https://training.galaxyproject.org/training-material/topics/admin/tutorials/celery/slides.html#1)
  * [cvmfs.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/cvmfs.yml): This playbook is used to setup the [CernVM-FS](https://cvmfs.readthedocs.io/en/stable/cpt-repo.html) server that is used by Galaxy to serve the reference data. Refer to these training materials for more information: [Reference Data with CVMFS](https://training.galaxyproject.org/training-material/topics/admin/tutorials/cvmfs/tutorial.html), and [Reference Data with CVMFS without Ansible](https://training.galaxyproject.org/training-material/topics/admin/tutorials/cvmfs-manual/tutorial.html)
  * [galaxy-test.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/galaxy-test.yml): This playbook is used to setup the Galaxy test instance. This is used to perform tests on the Galaxy codebase before deploying it to the main Galaxy instance.
  * [grafana.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/grafana.yml): This playbook is used to setup the [Grafana](https://grafana.com/) server that is used to [monitor our Galaxy instance](https://stats.galaxyproject.eu/). Refer to this [doc](https://github.com/usegalaxy-eu/operations/blob/f8062472110116a4ddf3035c3d43374443ec235e/cloud/services.md#grafana) and here is the training material [Galaxy Monitoring with Telegraf and Grafana](https://training.galaxyproject.org/training-material/topics/admin/tutorials/monitoring/tutorial.html)
  * [incoming.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/incoming.yml): This playbook is used to setup our [incoming FTP server](https://incoming.galaxyproject.eu/) through which users can upload their data to Galaxy. _Though this service is not retired, now we use [tus.io](https://tus.io/) for uploading data to Galaxy_. Our training materials on: [TUS](https://training.galaxyproject.org/training-material/topics/admin/tutorials/tus/tutorial.html) and [FTP](https://training.galaxyproject.org/training-material/topics/admin/tutorials/ftp/tutorial.html).
  * [influxdb.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/influxdb.yml): This playbook is used to setup the [InfluxDB](https://www.influxdata.com/) server that is used to store the metrics that are collected by Telegraf. Refer to [this](https://github.com/usegalaxy-eu/operations/blob/main/influxdb.md) and [this](https://github.com/usegalaxy-eu/operations/blob/main/cloud/services.md#influxdb) doc. Here is the [training material](https://training.galaxyproject.org/training-material/topics/admin/tutorials/monitoring/tutorial.html#influxdb)
  * [mq.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/mq.yml): This playbook is used to setup the [RabbitMQ](https://www.rabbitmq.com/) server that is used by Galaxy. Refer [here](https://github.com/usegalaxy-eu/operations/blob/f8062472110116a4ddf3035c3d43374443ec235e/cloud/services.md#rabbitmq) and [here](https://github.com/usegalaxy-eu/operations/blob/main/celery.md#chapter-one-down-the-rabbit-hole) for details.
  * [plausible.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/plausible.yml): This playbook is used to setup the [Plausible](https://plausible.io/) server that is used to collect the [analytics](https://stats.galaxyproject.eu/) for our Galaxy instance.
  * [sn05.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/sn05.yml): This playbook is used to setup the Galaxy PostgreSQL database server. (deprecated, use [sn11.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/sn11.yml) instead)
  * [sn06.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/sn06.yml): This playbook configures the [Galaxy server](https://usegalaxy.eu). This is the main Galaxy server that is used by the users. This we denote as `headnode 1`. Refer to this [training material](https://training.galaxyproject.org/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html) to set up Galaxy. (deprecated, use [sn09.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/sn09.yml) instead)
  * [sn07.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/sn07.yml): This playbook also configures the `galaxy server` but this is not in production (for now 22/02/2023). This we denote as `headnode 2`. Refer to this [training material](https://training.galaxyproject.org/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html) to set up Galaxy.
  * [sn09.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/sn09.yml): This playbook configures the [Galaxy server](https://usegalaxy.eu). This is the main Galaxy server that is used by the users. This we denote as `headnode 1`. Refer to this [training material](https://training.galaxyproject.org/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html) to set up Galaxy.
  * [sn11.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/sn11.yml): This playbook is used to setup the Galaxy PostgreSQL database server.
  * [syn-to-nfs.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/sync-to-nfs.yml): This playbook is used to sync the data of the Galaxy codebase on `headnode 1 (sn09)` to a NFS server. This is then synced to all nodes that needs the up-to-date Galaxy codebase and configuration files.
  * [telescope.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/telescope.yml): This playbook is used to setup the [Galactic Radio Telescope](https://github.com/hexylena/galactic-radio-telescope)
  * [upload.yml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/upload.yml): This playbook sets up the [TUS](https://tus.io/) server that is used to upload data to Galaxy. Refer to this [training material](https://training.galaxyproject.org/training-material/topics/admin/tutorials/tus/tutorial.html) to set up TUS.

  ## Roles
Our locally maintained Ansible roles are located in the [roles directory](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles). Also, we maintain several other roles and all of them are in their own github repositories and can be found in our [organization](https://github.com/orgs/usegalaxy-eu/repositories). Most of these roles are published on [Ansible Galaxy](https://galaxy.ansible.com/usegalaxy_eu). In addition to our roles we also use roles from the [galaxyproject](https://galaxy.ansible.com/galaxyproject) All the roles (non-local) we use are listed in our [requirements.yaml](https://github.com/usegalaxy-eu/infrastructure-playbook/blob/master/requirements.yaml) file. These roles can be installed by running the following command:

    ansible-galaxy install -r requirements.yaml

### Roles in use
* _**Separate repo:** Whether the role has its own repo or is it a local role located and available only in the [infrastructure_playbook](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles) repo_
* _**Still being used:** Whether the role is included/imported in any of the above listed playbooks_

| Roles | Separate repo | Still being used | Description |
| :--- | :---: | :---: | :--- |
| [devops.tomcat7](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/devops.tomcat7) |  | :heavy_check_mark: | Installs Tomcat 7 on RedHat/CentOS Linux servers |
| [dj-wasabi.telegraf](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/dj-wasabi.telegraf) |  | :heavy_check_mark: | Installs and configures [telegraf](https://www.influxdata.com/time-series-platform/telegraf/) |
| [docker](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/docker) |  |  | Installs and configures docker; sets up SSL certificates |
| [galaxyprojectdotorg.proftpd](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/galaxyprojectdotorg.proftpd) |  | :heavy_check_mark: | Installs, configures and manges [proftpd](http://www.proftpd.org/) (FTP) server.|
| [geerlingguy.haproxy](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/geerlingguy.haproxy) |  |  | Installs [HAProxy](https://www.haproxy.org/) |
| [geerlingguy.nginx](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/geerlingguy.nginx) |  |  | Installs and configures Nginx |
| [hostname](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hostname) |  | :heavy_check_mark: | Set's system's hostname |
| [htcondor](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/htcondor) |  |  | Installs and configures HTCondor |
| [hxr.admin-tools](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.admin-tools) |  | :heavy_check_mark: | Install's some admin packages via the package manager and stops firewalld service if its installed |
| [hxr.api-check](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.api-check) |  |  | Installs a bash script to check the http status |
| [hxr.apollo](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.apollo) |  | :heavy_check_mark: | Installs and configures a genome annotation web-based editor |
| [hxr.autofs](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.autofs) |  | :heavy_check_mark: | Installs autofs and adds autofs configuration to mount needed NFS shares _(NOTE: This should be merged/replaced with [usegalaxy-eu.autofs](https://github.com/usegalaxy-eu/ansible-autofs) role at some point)_ |
| [hxr.autofs-format-n-mount](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.autofs-format-n-mount) |  |  | Copies a script to format a certain disk and mount it |
| [hxr.aws-cli](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.aws-cli) |  | :heavy_check_mark: | Creates AWS directory (`~/.aws`) and deploys (copies) AWS credentials to a given system user account |
| [hxr.dns](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.dns) |  |  | Sets DNS entries using `route53` and refreshes the certbot certificates if domains have changed |
| [hxr.docker-ssl](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.docker-ssl) |  |  | Configures docker to use SSL certificates |
| [hxr.docker-ssl-client](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.docker-ssl-client) |  |  | Adds SSL certs to the user home directory |
| [hxr.exclude-repo](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.exclude-repo) |  |  | Excludes a given list of YUM repositories |
| [hxr.galaxy-cron](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.galaxy-cron) |  |  | Adds cron jobs for cleaning up docker (via `prune`) and for cleaning up condor held jobs |
| [hxr.galaxy-echo-tool](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.galaxy-echo-tool) |  |  | Add a custom nagios "echo" tool to the Galaxy tool directory |
| [hxr.galaxy-log-dir](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.galaxy-log-dir) |  |  | Creates galaxy log directory if it does not exist |
| [hxr.galaxy-nonreproducible-tools](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.galaxy-nonreproducible-tools) |  | :heavy_check_mark: | Clones temporary tools repo to the Galaxy's custom tools directory |
| [hxr.grafana-gitter-bridge](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.grafana-gitter-bridge) |  | :heavy_check_mark: | Configures a bridge between Grafana and Gitter |
| [hxr.gx-cookie-proxy](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.gx-cookie-proxy) |  |  | Sets up and configures the [translation of a galaxy session cookie into a remote user identity](https://github.com/hexylena/gx-cookie-proxy/) |
| [hxr.haproxy-error-pages](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.haproxy-error-pages) |  |  | Downloads Galaxy error pages through a bash script _(NOTE: Bash script is not found in the role, so can't explain what these error pages are)_ |
| [hxr.install-to-venv](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.install-to-venv) |  | :heavy_check_mark: | Installs Python dependencies into any requested virtual environment |
| [hxr.monitor-cluster](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.monitor-cluster) |  | :heavy_check_mark: | Adds Condor cluster monitoring scripts and configures Telegraf user to run these scripts |
| [hxr.monitor-cvmfs](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.monitor-cvmfs) |  | :heavy_check_mark: | Adds a Telegraf task that monitors the CernVM-FS repos |
| [hxr.monitor-email](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.monitor-email) |  | :heavy_check_mark: | Adds an `/var/spool/mail` counter script and adds an Telegraf task to monitor |
| [hxr.monitor-galaxy](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.monitor-galaxy) |  |  | _NOTE: Tasks file is empty_ |
| [hxr.monitor-galaxy-journalctl](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.monitor-galaxy-journalctl) |  | :heavy_check_mark: | Adds a script and a Telegraf task to monitor Galaxy's journalctl logs |
| [hxr.monitor-galaxy-queue](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.monitor-galaxy-queue) |  |  | Adds a Telegraf task to run `gxadmin` queries for monitoring Galaxy queue and workflow-incovcation-status |
| [hxr.monitor-squid](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.monitor-squid) |  | :heavy_check_mark: | Adds a [squid proxy](https://github.com/squid-cache/squid) data parser script and a Telegraf task to monitor |
| [hxr.monitor-ssl](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.monitor-ssl) |  | :heavy_check_mark: | Adds an SSL check script and a Telegraf task to monitor SSL certificates expiry |
| [hxr.postgres-connection](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.postgres-connection) |  | :heavy_check_mark: | Adds Galaxy database credentials and required ENVs to the user's bashrc file and creates a `~/.pgpass` file as well |
| [hxr.remap-user](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.remap-user) |  | :heavy_check_mark: | Remaps system user's UID and GID to the tomcat user/group |
| [hxr.replace-galaxy-user](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.replace-galaxy-user) |  | :heavy_check_mark: | Creates a system user and group with 999 as UID and GID |
| [hxr.sentry](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.sentry) |  |  | Installs and configures [Sentry](https://github.com/getsentry/self-hosted) service |
| [hxr.simple-nagios](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.simple-nagios) |  |  | Installs a few "simple" scripts that performs various tasks related to Galaxy, Nagios, and SSL certificate check |
| [hxr.zfs-monit](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/hxr.zfs-monit) |  |  | _NOTE: Task file does not exist_ |
| [jasonroyle.rabbitmq](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/jasonroyle.rabbitmq) |  |  | Installs and configures [RabbitMQ](https://www.rabbitmq.com/) |
| [linuxhq.yum_cron](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/linuxhq.yum_cron) |  | :heavy_check_mark: | Installs `yum-cron` and adds required configuration |
| [matterircd](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/matterircd) |  |  | Sets up a minimal IRC server using Docker that can integrate with mattermost, slack, and mastodon |
| [multinic](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/multinic) |  |  | Adds network config files and configures multiple NICs |
| [multinic-old](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/multinic-old) |  |  | Same as [multinic](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/multinic) but without routing config etc. |
| [pgs](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/pgs) |  | :heavy_check_mark: | Sets upProbes [Public Galaxy Servers](https://github.com/martenson/public-galaxy-servers) (pgs) instances |
| [sentry](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/sentry) |  |  | Sets up [Sentry](https://sentry.io/welcome/) a realtime event logging and aggregation platform using Docker |
| [ssh-host-resign](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/ssh-host-resign) |  | :heavy_check_mark: | Copies server CA and signs the Host SSH keys |
| [ssh-host-sign](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/ssh-host-sign) |  | :heavy_check_mark: | Sign the server host key to prevent [TOFU](https://www.mioso.com/blog/it-security/schluss-mit-tofu-bei-ssh/) for SSH |
| [usegalaxy-eu.bashrc](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.bashrc) |  | :heavy_check_mark: | Adds ENVs, aliases, etc. to the bashrc file for any given user |
| [usegalaxy-eu.create-user](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.create-user) |  | :heavy_check_mark: | Creates a `galaxy` system user and group |
| [usegalaxy-eu.error-pages](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.error-pages) |  | :heavy_check_mark: | Copies Nginx's error (404, 502, 503, and 504) pages |
| [usegalaxy-eu.fix-ancient-ftp-data](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.fix-ancient-ftp-data) |  | :heavy_check_mark: | Removes old FTP data and adds a cron job to create FTP users |
| [usegalaxy-eu.fix-failing-to-fail-jobs](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.fix-failing-to-fail-jobs) |  | :heavy_check_mark: | Adds a cron job to fix failing to fail jobs |
| [usegalaxy-eu.fix-galaxy-server-dir](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.fix-galaxy-server-dir) |  | :heavy_check_mark: | Creates a GDPR compliance log file if it does not exist and creates a symlink of all tools present in `/usr/local/tools` to `<galaxy_server_dir>/dependencies` |
| [usegalaxy-eu.fix-missing-api-keys](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.fix-missing-api-keys) |  | :heavy_check_mark: | Adds a cron job that generates and adds missing API keys for IE ([Interactive Environments](https://training.galaxyproject.org/training-material/topics/dev/tutorials/interactive-environments/slides-plain.html)) users |
| [usegalaxy-eu.fix-oidc](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.fix-oidc) |  | :heavy_check_mark: | Adds a cron job that finds all of the OIDC authenticated users that do not have any roles associated to them and fixes them |
| [usegalaxy-eu.fix-stop-ITs](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.fix-stop-ITs) |  | :heavy_check_mark: | Adds a cron job that finds the [Galaxy ITs](https://training.galaxyproject.org/training-material/topics/admin/tutorials/interactive-tools/tutorial.html) running longer than 24 hrs and terminates them |
| [usegalaxy-eu.fix-stuck-handlers](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.fix-stuck-handlers) |  | :heavy_check_mark: | Adds several cron jobs (sync-to-nfs, restart galaxy handlers systemd service, restart gunicorn systemd service, restart galaxy workflow schedulers systemd service) |
| [usegalaxy-eu.fix-unscheduled-jobs](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.fix-unscheduled-jobs) |  | :heavy_check_mark: | Adds a cron job that finds the Galaxy jobs that failed to run (unscheduled) and sets its `state` to `error` in the Galaxy database |
| [usegalaxy-eu.fix-unscheduled-workflows](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.fix-unscheduled-workflows) |  | :heavy_check_mark: | Adds a cron job _(the Ansible task is commented, so it does not create a cron job at the moment)_ that fixes unscheduled workflows |
| [usegalaxy-eu.fix-user-quotas](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.fix-user-quotas) |  | :heavy_check_mark: | Adds cron jobs that recalculates user quotas and sets ELIXIR quota for ELIXIR users |
| [usegalaxy-eu.galactic-radio-telescope](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.galactic-radio-telescope) |  | :heavy_check_mark: | Installs and configures [Galactic Radio Telescope](https://github.com/erasche/galactic-radio-telescope)  |
| [usegalaxy-eu.galaxy-cleanup](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.galaxy-cleanup) |  | :heavy_check_mark: | Adds a Telegraf task that performs a cleanup of histories/hdas/etc that are older than 60 days |
| [usegalaxy-eu.galaxy-procstat](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.galaxy-procstat) |  | :heavy_check_mark: | Adds Telegraf [procstat](https://www.influxdata.com/integration/procstat/) tasks that collects metrics from processes (Gunicorn, Galaxy handlers, Galaxy workflow schedulers) |
| [usegalaxy-eu.galaxy-slurp](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.galaxy-slurp) |  | :heavy_check_mark: | Adds cron jobs for pulling Galaxy stats (like, how many users were registered as of date X, current user count, current dataset size/distribution/etc.) into InfluxDB using `gxadmin`'s `slurp` commands |
| [usegalaxy-eu.gapars-galaxy](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.gapars-galaxy) |  | :heavy_check_mark: | Sets up and installs the [GAPARS](http://gapars.mmos.ch/) Galaxy [webhook](https://github.com/galaxyecology/webhook_SPIPOLL_Flash) |
| [usegalaxy-eu.gie-deployer](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.gie-deployer) |  |  | Creates [GIE](https://docs.galaxyproject.org/en/release_20.09/admin/special_topics/interactive_environments.html) (Galaxy Interactive Environments) required directories, adds config, etc to deploy GIE |
| [usegalaxy-eu.gie-node-proxy](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.gie-node-proxy) |  |  | Clones [GIE NodeJS proxy](https://github.com/galaxyproject/gx-it-proxy) configurations and installs Node dependencies and sets up the [GIE proxy](https://docs.galaxyproject.org/en/release_20.09/admin/special_topics/interactive_environments.html#setting-up-the-proxy)  |
| [usegalaxy-eu.google-verification](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.google-verification) |  |  | Adds Google site verification HTML file and adds required Nginx configuration |
| [usegalaxy-eu.grt-client](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.grt-client) |  |  | Adds cron jobs that can export and upload data to [GRT](https://github.com/hexylena/galactic-radio-telescope) |
| [usegalaxy-eu.grt-export](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.grt-export) |  |  | Adds a cron job that exports data to GRT |
| [usegalaxy-eu.htcondor_release](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.htcondor_release) |  | :heavy_check_mark: | Adds a cron job that releases Condor jobs that are in hold state _(also removes jobs in hold state that are resubmitted more than two times)_ |
| [usegalaxy-eu.jenkins-ssh-key](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.jenkins-ssh-key) |  | :heavy_check_mark: | Creates SSH directory and adds a key to the Jenkins user |
| [usegalaxy-eu.log-cleaner](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.log-cleaner) |  | :heavy_check_mark: | Adds cron job to clean up old journalctl logs of gunicorn and galaxy handlers services |
| [usegalaxy-eu.logrotate](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.logrotate) |  | :heavy_check_mark: | Adds logrotate configuration for galaxy and atop logs  |
| [usegalaxy-eu.monitoring](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.monitoring) |  | :heavy_check_mark: | Adds Telegraf tasks for monitoring NFS shares access times, and to collect NFS stats |
| [usegalaxy-eu.plausible](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.plausible) |  | :heavy_check_mark: | Clones [Plausible](https://github.com/plausible/analytics)  Analytics [setup](https://github.com/usegalaxy-eu/hosting) and adds the configuration and starts the service using Docker |
| [usegalaxy-eu.remap-user](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.remap-user) |  |  | Remaps system user and group with UID and GID 999 to a different UID and GID so Galaxy user can be created with 999 UID and GID |
| [usegalaxy-eu.rsync-to-nfs](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.rsync-to-nfs) |  | :heavy_check_mark: | Adds and executes a script that performs a Rsync operation of the Galaxy root directory to NFS location |
| [usegalaxy-eu.subdomain-themes](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.subdomain-themes) |  | :heavy_check_mark: | Adds custom subdomain themes (HTML and CSS files) |
| [usegalaxy-eu.tours](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.tours) |  | :heavy_check_mark: | Clones Galaxy [tours repo](https://github.com/usegalaxy-eu/galaxy-tours)  |
| [usegalaxy-eu.webhooks](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.webhooks) |  | :heavy_check_mark: | Clones [webhooks repo](https://github.com/usegalaxy-eu/galaxy-webhooks) |
| [usegalaxy-eu.vgcn-monitoring](https://github.com/usegalaxy-eu/infrastructure-playbook/tree/master/roles/usegalaxy-eu.vgcn-monitoring) |  | :heavy_check_mark: | Adds VGCN monitoring python script and a Telegraf configuration file |
| [dev-sec.os-hardening](https://galaxy.ansible.com/devsec/hardening) | :heavy_check_mark: | :heavy_check_mark: | Now, part of [devsec.hardening](https://github.com/dev-sec/ansible-collection-hardening) collection. This [role](https://github.com/dev-sec/ansible-collection-hardening/tree/master/roles/os_hardening) provides numerous security-related configurations, providing all-round base protection to the system |
| [dev-sec.ssh-hardening](https://galaxy.ansible.com/devsec/hardening) | :heavy_check_mark: | :heavy_check_mark: | Now, part of [devsec.hardening](https://github.com/dev-sec/ansible-collection-hardening) collection. This [role](https://github.com/dev-sec/ansible-collection-hardening/tree/master/roles/ssh_hardening) provides secure ssh-client and ssh-server configurations. |
| [devops.tomcat7](https://galaxy.ansible.com/devops/tomcat7) | :heavy_check_mark: | :heavy_check_mark: | Installs Tomcat 7 on RedHat/CentOS Linux servers |
| [dj-wasabi.telegraf](https://galaxy.ansible.com/dj-wasabi/telegraf) | :heavy_check_mark: | :heavy_check_mark: | Installs and configures [Telegraf](https://www.influxdata.com/time-series-platform/telegraf/) |
| [galaxyproject.galaxy](https://github.com/galaxyproject/ansible-galaxy) | :heavy_check_mark: | :heavy_check_mark: | Installs and configures [Galaxy](https://galaxyproject.org/) |
| [galaxyproject.cvmfs](https://github.com/usegalaxy-eu/ansible-cvmfs) | :heavy_check_mark: | :heavy_check_mark: | Install and configure [CernVM-FS (CVMFS)](https://cernvm.cern.ch/portal/filesystem), particularly for Galaxy servers. |
| [galaxyproject.proftpd](https://galaxy.ansible.com/galaxyproject/proftpd) | :heavy_check_mark: | :heavy_check_mark: | Installs, configures and manges proftpd (FTP) server. |
| [usegalaxy_eu.ansible_nginx_upload_module](https://galaxy.ansible.com/usegalaxy_eu/ansible_nginx_upload_module) | :heavy_check_mark: | :heavy_check_mark: | Role for building the Nginx upload module |
| [usegalaxy-eu.nginx](https://github.com/usegalaxy-eu/ansible-nginx) | :heavy_check_mark: | :heavy_check_mark: | Role for installing and managing nginx servers |
| [galaxyproject.nginx](https://galaxy.ansible.com/galaxyproject/nginx) | :heavy_check_mark: | :heavy_check_mark: | Role for installing and managing nginx servers |
| [galaxyproject.postgresql](https://galaxy.ansible.com/galaxyproject/postgresql) | :heavy_check_mark: |  |  Role for installing and managing PostgreSQL servers |
| [usegalaxy-eu.ansible-postgresql](https://github.com/usegalaxy-eu/ansible-postgresql) | :heavy_check_mark: | :heavy_check_mark: | Role for installing and managing PostgreSQL servers |
| [geerlingguy.docker](https://galaxy.ansible.com/geerlingguy/docker) | :heavy_check_mark: | :heavy_check_mark: | Role for installing [Docker](https://www.docker.com/) |
| [geerlingguy.java](https://galaxy.ansible.com/geerlingguy/java) | :heavy_check_mark: | :heavy_check_mark: | Role for installing Java |
| [geerlingguy.jenkins](https://galaxy.ansible.com/geerlingguy/jenkins) | :heavy_check_mark: | :heavy_check_mark: | Role for installing [Jenkins CI](https://www.jenkins.io/) |
| [geerlingguy.repo-epel](https://galaxy.ansible.com/geerlingguy/repo-epel) | :heavy_check_mark: | :heavy_check_mark: | Installs the [EPEL repository](https://fedoraproject.org/wiki/EPEL) |
| [influxdata.chrony](https://github.com/usegalaxy-eu/ansible-chrony) | :heavy_check_mark: | :heavy_check_mark: | Manages the Chrony services on Linux. |
| [linuxhq.yum_cron](https://galaxy.ansible.com/linuxhq/yum_cron) | :heavy_check_mark: | :heavy_check_mark: | Installs `yum-cron` and adds required configuration  |
| [galaxyproject.gxadmin](https://galaxy.ansible.com/galaxyproject/gxadmin) | :heavy_check_mark: | :heavy_check_mark: | Installs and configures [gxadmin](https://github.com/galaxyproject/gxadmin) |
| [usegalaxy-eu.certbot](https://github.com/usegalaxy-eu/ansible-certbot) | :heavy_check_mark: |  | Installs and configures Certbot (for Let's Encrypt). |
| [usegalaxy_eu.galaxy_systemd](https://galaxy.ansible.com/usegalaxy_eu/galaxy_systemd) | :heavy_check_mark: | :heavy_check_mark: | Copies systemd service files and starts processes for Gunicorn handlers, Galaxy (workflow) handlers and celery. Important to configure those processes|
| [usegalaxy-eu.dynmotd](https://github.com/usegalaxy-eu/ansible-dynmotd) | :heavy_check_mark: | :heavy_check_mark: | Sets up a dynamic message-of-the-day login prompt |
| [cloudalchemy.grafana](https://galaxy.ansible.com/cloudalchemy/grafana) | :heavy_check_mark: | :heavy_check_mark: | Role for provisioning and managing [Grafana](https://grafana.com/) platform for analytics and monitoring |
| [galaxyproject.tiaas2](https://galaxy.ansible.com/galaxyproject/tiaas2) | :heavy_check_mark: | :heavy_check_mark: | Install and configure [TIaaS](https://github.com/galaxyproject/tiaas2) (Training Infrastructure as a Service) |
| [usegalaxy-eu.autoupdates](https://github.com/usegalaxy-eu/ansible-autoupdates) | :heavy_check_mark: | :heavy_check_mark: | Sets up automatic system Updates using Dnf-automatic |
| [usegalaxy_eu.htcondor](https://galaxy.ansible.com/usegalaxy_eu/htcondor) | :heavy_check_mark: | :heavy_check_mark: | Role for installing and configuring [HTCondor](https://htcondor.org/) |
| [usegalaxy-eu.update-hosts](https://github.com/usegalaxy-eu/ansible-update-hosts) | :heavy_check_mark: | :heavy_check_mark: | Adds a cron job to update computing nodes list in a HTCondor managed cluster |
| [usegalaxy_eu.gie_proxy](https://galaxy.ansible.com/usegalaxy_eu/gie_proxy) | :heavy_check_mark: | :heavy_check_mark: | Install and configure the proxy server used by Galaxy for IE (Interactive Environments) /IT (Interactive Tools) |
| [usegalaxy-eu.autofs](https://github.com/usegalaxy-eu/ansible-autofs) | :heavy_check_mark: | :heavy_check_mark: | Installs autofs and configures mount points for auto mounting |
| [usegalaxy_eu.fs_maintenance](https://galaxy.ansible.com/usegalaxy_eu/fs_maintenance) | :heavy_check_mark: | :heavy_check_mark: | Role for deploying and configuring some common Galaxy file system maintenance routines and also adds cron jobs |
| [galaxyproject.tusd](https://galaxy.ansible.com/galaxyproject/tusd) | :heavy_check_mark: | :heavy_check_mark: | Installs and configures the [tusd](https://tus.io/) server |
| [usegalaxy_eu.rabbitmqserver](https://galaxy.ansible.com/usegalaxy_eu/rabbitmqserver) | :heavy_check_mark: | :heavy_check_mark: | Role to deploy and configure a RabbitMQ server using a docker container |
| [usegalaxy_eu.influxdbserver](https://galaxy.ansible.com/usegalaxy_eu/influxdbserver) | :heavy_check_mark: | :heavy_check_mark: | Role to deploy and configure an InfluxDB server using a docker container |
| [usegalaxy_eu.flower](https://galaxy.ansible.com/usegalaxy_eu/flower) | :heavy_check_mark: | :heavy_check_mark: | Role for installing Celery's Web UI [Flower](http://flower.readthedocs.io/en/latest/). |
| [paprikant.beacon](https://github.com/Paprikant/ansible-role-beacon) | :heavy_check_mark: | :heavy_check_mark: | Role that sets up a running instance of [beacon-python](https://beacon-python.readthedocs.io/en/latest/), with an accompaning PostgreSQL database |
| [paprikant.beacon-importer](https://github.com/Paprikant/ansible-role-beacon_importer) | :heavy_check_mark: | :heavy_check_mark: | Sets up Beacon importer and adds a cron job for the import task |
| [galaxyproject.miniconda](https://galaxy.ansible.com/galaxyproject/miniconda) | :heavy_check_mark: | :heavy_check_mark: | Role for installing and managing Miniconda installation and Conda environments|
| [usegalaxy_eu.tpv_auto_lint](https://galaxy.ansible.com/usegalaxy_eu/tpv_auto_lint) | :heavy_check_mark: | :heavy_check_mark: | Adds a [TPV](https://total-perspective-vortex.readthedocs.io/en/latest/) (Total Perspective Vortex) [lint](https://total-perspective-vortex.readthedocs.io/en/latest/topics/shell_commands.html#lint) script that automatically lints all TPV YAML files |
